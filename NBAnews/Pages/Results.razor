@page "/results"
@using RestSharp
@using NBAnews.Model
@inject HttpClient Http


<PageTitle>Last results</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Last results</MudText>

@if (_games == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <MudTable Items="_games" Hover="true" SortLabel="Sort By" Elevation="0">
        <HeaderContent>
            <MudTh>Date</MudTh>
            <MudTh>Home team</MudTh>
            <MudTh>Home team score</MudTh>
            <MudTh>Versus team</MudTh>
            <MudTh>Versus team score</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Date">@context.StartTimeUtc.Date.ToShortDateString()</MudTd>
            <MudTd DataLabel="Temp. (C)">@context.HTeam.FullName</MudTd>
            <MudTd DataLabel="Temp. (F)">@context.HTeam.Score.Points</MudTd>
            <MudTd DataLabel="Summary">@context.VTeam.FullName</MudTd>
            <MudTd DataLabel="Summary">@context.VTeam.Score.Points</MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager PageSizeOptions="new int[]{50, 100}" />
        </PagerContent>
    </MudTable>
}


@code {
    private List<Game>? _games;
    private Result? _results;

    protected override async Task OnInitializedAsync()
    {
        var client = new HttpClient();
        var request = new HttpRequestMessage
        {
            Method = HttpMethod.Get,
            RequestUri = new Uri("https://api-nba-v1.p.rapidapi.com/games/date/2021-12-23"),
            Headers =
            {
                { "x-rapidapi-host", "api-nba-v1.p.rapidapi.com" },
                { "x-rapidapi-key", "320aa979eamshbb837acae064e6bp1f6968jsn57008a862c0f" },
            },
        };
        using var response = await client.SendAsync(request);
        response.EnsureSuccessStatusCode();
        _results = await response.Content.ReadFromJsonAsync<Result>();
        if (_results?.Api.Games != null) 
            _games = _results.Api.Games;
    }
}
